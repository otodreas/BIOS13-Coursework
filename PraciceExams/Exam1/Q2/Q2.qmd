# Dynamics of a spatially structured population

## Part A: Non-trivial equilibrium population size

The equilibrium population sizes are defined as the values of $n_1$ for which the change in population size over time $\frac{dn_1}{dt} = 0$. For this condition to be true, one of the two terms $r_1 - k n_1^2$ or $n_1$ must equal $0$, since their product is the change in population size over time $\frac{dn_1}{dt}$.

Thus, the non-trivial solution is

$$
r_1 - k n_1^2 = 0 \Rightarrow n_1 = \sqrt{\frac{r_1}{k}}
$$

## Part B: Prove stability of equilibrium

For the equilibrium to be stable, the first derivative of the model (the second derivative if the model represents population rather than change in population) must be negative. If this condition is met, population sizes immediately below the equilibrium will have a positive $\frac{dn_1}{dt}$, meaning that the population will grow towards the equilibrium size, while population sizes immediately above the equilibrium will have a negative $\frac{dn_1}{dt}$ and shrink towards the equilibrium size.

To determine the stability of the equilibrium, we first rearrange $\frac{dn_1}{dt}$ at the non-trivial equilibrium, where (I've "renamed" it to $f'(n_1)$ for clarity).

$$
\begin{align}
    f'(n_1) &= \left(r_1 - k \sqrt{\frac{r_1}{k}} \right) \sqrt{\frac{r_1}{k}} \\
    &= r_1 \sqrt{\frac{r_1}{k}} - k \frac{r_1}{k} \\
    &= r_1 \left(r_1^{\frac{1}{2}} k^{\frac{-1}{2}} \right) - k \left(r_1 k^{\frac{-1}{2}} \right) \\
    &= r_1^{\frac{3}{2}} k^{\frac{-1}{2}} - k^{\frac{1}{2}} r_1
\end{align}
$$

We can now get the second derivative $f''(n_1)$

$$
\begin{align}
    f''(n_1) &= \frac{3}{2} r_1^{\frac{1}{2}} \times \frac{-1}{2} k^{\frac{-3}{2}} - \frac{1}{2} k^{\frac{-1}{2}} \times 1 \\
    &= - \frac{3 \sqrt{r_1}}{4 \sqrt{k^3}} - \frac{1}{2 \sqrt{k}}
\end{align}
$$

Since both $r_1$ and $k$ are positive, both terms of $f''(n_1)$ are negative, and since the exponentiation performed on $r_1$ and $k$ cannot produce a negative result, there are no possible values for $r_1$ and $k$ that could make $f''(n_1)$ positive. Therefore

$$
f''(n_1) < 0
$$

When

$$
n_1 = \sqrt{\frac{r_1}{k}}
$$

Thus, the non-trivial equilibrium is stable.

## Part C: Plot $\frac{dn}{dt}$

```{r}
# Clear variables
rm(list = ls())

# Parameters
r1 <- 60
k <- 0.03

# Vector of population sizes
n1 <- seq(0, 100)

# Vector to store population change at each population size
dndt <- n1

# Loop through values of n, update corresponding dndt
for (i in seq_along(n1)) dndt[i] <- (r1 - k * n1[i] ** 2) * n1[i]

# Plot
plot(
    n1, dndt, type = "l", main = "Dynamics of\npopulation 1",
    xlab = "Population size", ylab = "Derivative of population size"
)

# Clear variables
rm(list = ls())
```

## Part D: Write new equations

Since $m$ individuals leave population 1 for population 2 per unit time, the system of equations that describes the population dynamics of $n_1$ and $n_2$ is defined as

$$
\begin{cases}
\begin{align}
    \frac{dn_1}{dt} &= \left( r_1 - k n_1^2 \right) n_1 - m n_1 \\
    \frac{dn_2}{dt} &= \left( r_2 - k n_2^2 \right) n_2 + m n_1
\end{align}
\end{cases}
$$

## Part E: New equilibrium of population 1

Since the equilibrium is defined as the value of $n_1$ when $\frac{dn_1}{dt} = 0$, we assert the equation below and solve for $n_1$.

$$
\begin{align}
    \left( r_1 - k n_1^2 \right) n_1 - m n_1 &= 0 \\
    \left( r_1 - k n_1^2 \right) n_1 &= m n_1 \\
    r_1 - k n_1^2 &= m \\
    n_1 &= \sqrt{\frac{m - r_1}{-k}}
\end{align}
$$

Thus, when the size of population 1 is $\sqrt{\frac{m - r_1}{-k}}$, the population is in equilibrium.

## Part F: Value of *m* where population 1 goes extinct

For a given population size $n_1$, the parameter $m$ must be large enough to make $\frac{dn_1}{dt}$ negative. Thus, the term $m n_1$ must be greater than the term $\left(r_1 - k n_^2 \right) n_1$. We can solve by asserting the equation below and solving for $m$.

$$
\begin{align}
    m n_1 &> \left( r_1 - k n_1^2 \right) n_1 \\
    m &> r_1 - k n_1^2
\end{align}
$$

Thus, if $m > r_1 - k n_1^2$, the population goes extinct.

## Part G: Simulate coupled dynamics

```{r}
# Clear variables
rm(list = ls())

# Install and mount packages
# install.packages("deSolve")
library(deSolve)

# Assign starting state values
y <- list(700, 400)
names(y) <- c("n1", "n2")

# Assign vector containing time sequence
times <- seq(0, 100)

# Assign parameters
params <- list(50, 60, 0.03, 0.1)
names(params) <- c("r2", "r1", "k", "m")

# Assign empty list in which to store ODE outputs
outs <- list(0, 0)
names(outs) <- c("Pop1", "Pop2")

# Assign function to compute values of derivatives in system
func <- function(y, r, k, m) {
    dn1dt <- (r1 - k * n1 ** 2) * n1 - m * n1
    dn2dt <- (r2 - k * n2 ** 2) * n2 - m * n1
    derivatives <- list(dn1dt, dn2dt)
    names(derivatives) <- c("dn1dt", "dn2dt")
    return(derivatives)
}

# Run ODE solver for both populations
for (i in 1:2) outs[i] <- ode(y[[i]], times, func, params[-i])

# Plot
plot(
    times, outs[1], type = "l" main = "Populations over time",
    xlab = "Time", ylab = "Population size", col = "blue"
)

# Clear variables
rm(list = ls())
```